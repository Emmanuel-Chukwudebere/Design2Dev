(()=>{"use strict";var e=function(e,n,i,t){return new(i||(i=Promise))((function(o,a){function s(e){try{l(t.next(e))}catch(e){a(e)}}function r(e){try{l(t.throw(e))}catch(e){a(e)}}function l(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,r)}l((t=t.apply(e,n||[])).next())}))};const n={isAnalyzing:!1,isExporting:!1,shouldCancel:!1,selectedDesignSystem:"react-native-paper",screenSpecs:[],error:null};function i(e,n){figma.ui.postMessage({type:e,payload:n})}function t(e,i){console.error(`Error in ${i}:`,e),n.error=e,figma.notify(`Error in ${i}: ${e.message}`,{error:!0})}function o(e){const i=[],t=new Set,o=new Map;return e.findAll((e=>{var n,o;const s={id:e.id,name:e.name,type:e.type.toLowerCase(),position:{x:e.x,y:e.y},dimensions:{width:e.width,height:e.height},styling:a(e),parent:null===(n=e.parent)||void 0===n?void 0:n.id,children:"children"in e?e.children.map((e=>e.id)):[],zIndex:e.parent?e.parent.children.indexOf(e):0};var r;if("TEXT"===e.type&&(s.content=e.characters,s.textStyle={fontFamily:(r=e.fontName,r&&"object"==typeof r&&"family"in r?e.fontName.family:"Inter"),fontSize:"number"==typeof e.fontSize?e.fontSize:16,fontWeight:400,lineHeight:"number"==typeof e.lineHeight?e.lineHeight:1.2,letterSpacing:"number"==typeof e.letterSpacing?e.letterSpacing:0,textAlign:(null===(o=e.textAlignHorizontal)||void 0===o?void 0:o.toLowerCase())||"left",color:"#000000"}),s.styling){const e=s.styling;(e.shadowColor||e.shadowOffset)&&t.add("react-native-shadow-2"),e.animation&&t.add("react-native-reanimated")}return i.push(s),!1})),{id:`screen-${e.id}`,name:e.name,dimensions:{width:e.width,height:e.height},layout:a(e),designSystem:n.selectedDesignSystem,elements:i,dependencies:Array.from(t),interactions:Object.fromEntries(o)}}function a(e){const n={};return"opacity"in e&&(n.opacity=e.opacity),"visible"in e&&(n.visible=e.visible),"rotation"in e&&(n.rotation=e.rotation),"blendMode"in e&&(n.blendMode=e.blendMode),"effects"in e&&(n.effects=e.effects.map((e=>{const n={type:e.type,visible:!0,blendMode:"NORMAL"};return"color"in e?Object.assign(Object.assign({},n),{color:e.color,offset:e.offset,radius:e.radius,spread:e.spread}):"radius"in e?Object.assign(Object.assign({},n),{radius:e.radius}):n}))),n}figma.showUI(__html__,{width:400,height:600}),console.log("Sending initial state"),i("PLUGIN_READY"),i("PAGE_INFO",{name:figma.currentPage.name,nodeCount:figma.currentPage.children.length}),figma.on("selectionchange",(()=>e(void 0,void 0,void 0,(function*(){const a=figma.currentPage.selection;if(a.length>0&&a.length<=8){const s=a.filter((e=>"FRAME"===e.type));if(s.length>0)try{n.isAnalyzing=!0,i("ANALYSIS_STARTED");const t=yield function(i){return e(this,void 0,void 0,(function*(){try{const t=i.map(o);return yield Promise.all(t.map((i=>e(this,void 0,void 0,(function*(){const e=yield fetch("http://localhost:3000/api/analyze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer d2d1"},body:JSON.stringify({screen:i,designSystem:n.selectedDesignSystem})});if(!e.ok)throw new Error(`Analysis failed: ${e.statusText}`);return e.json()})))))}catch(e){throw console.error("Analysis error:",e),e}}))}(s);n.screenSpecs=t,i("ANALYSIS_COMPLETE",{screenSpecs:t,designSystem:n.selectedDesignSystem})}catch(e){t(e,"analysis"),i("ANALYSIS_FAILED")}finally{n.isAnalyzing=!1}}})))),figma.ui.onmessage=o=>e(void 0,void 0,void 0,(function*(){console.log("Plugin received message:",o);try{switch(o.type){case"INIT":console.log("Received INIT message, sending PLUGIN_READY"),i("PLUGIN_READY"),i("PAGE_INFO",{name:figma.currentPage.name,nodeCount:figma.currentPage.children.length});break;case"ANALYZE_SCREENS":if(n.isAnalyzing||n.isExporting)return void figma.ui.postMessage({type:"ANALYSIS_ERROR",payload:{error:"Another operation is in progress"}});n.isAnalyzing=!0,n.shouldCancel=!1;try{const i=figma.currentPage.selection;if(0===i.length)throw new Error("Please select at least one frame to analyze");if(i.length>8)throw new Error("Please select no more than 8 frames");const t=i.filter((e=>"FRAME"===e.type));if(0===t.length)throw new Error("Please select valid frames to analyze");figma.ui.postMessage({type:"ANALYSIS_PROGRESS",payload:{message:"Analyzing frames..."}});const a=yield Promise.all(t.map(((i,a)=>e(void 0,void 0,void 0,(function*(){if(n.shouldCancel)throw new Error("Analysis cancelled");return figma.ui.postMessage({type:"ANALYSIS_PROGRESS",payload:{message:`Analyzing frame ${a+1} of ${t.length}...`}}),yield s(i,o.payload.designSystem)})))));if(n.shouldCancel)throw new Error("Analysis cancelled");figma.ui.postMessage({type:"ANALYSIS_PROGRESS",payload:{message:"Finalizing analysis..."}}),figma.ui.postMessage({type:"ANALYSIS_COMPLETE",payload:{screenSpecs:a}})}catch(e){n.shouldCancel||figma.ui.postMessage({type:"ANALYSIS_ERROR",payload:{error:e instanceof Error?e.message:"Unknown error"}})}finally{n.isAnalyzing=!1,n.shouldCancel=!1}break;case"EXPORT_BUNDLE":if(n.isAnalyzing||n.isExporting)return void figma.ui.postMessage({type:"EXPORT_ERROR",payload:{error:"Another operation is in progress"}});n.isExporting=!0,n.shouldCancel=!1;try{if(n.shouldCancel)throw new Error("Export cancelled");const{screenSpecs:e}=o.payload,i=yield r(e);if(n.shouldCancel)throw new Error("Export cancelled");figma.ui.postMessage({type:"EXPORT_COMPLETE",payload:{bundle:i}})}catch(e){n.shouldCancel||figma.ui.postMessage({type:"EXPORT_ERROR",payload:{error:e instanceof Error?e.message:"Unknown error"}})}finally{n.isExporting=!1,n.shouldCancel=!1}break;case"CANCEL_OPERATION":n.shouldCancel=!0;break;default:console.log("Unknown message type:",o.type)}}catch(e){console.error("Error handling message:",e),t(e,"message handling")}})),figma.on("close",(()=>{n.isAnalyzing=!1,n.isExporting=!1,n.error=null}));const s=(n,i)=>e(void 0,void 0,void 0,(function*(){return{id:n.id,name:n.name,dimensions:{width:n.width,height:n.height},layout:{layoutMode:n.layoutMode,primaryAxisAlignItems:n.primaryAxisAlignItems,counterAxisAlignItems:n.counterAxisAlignItems,padding:n.paddingTop?{top:n.paddingTop,right:n.paddingRight,bottom:n.paddingBottom,left:n.paddingLeft}:void 0,itemSpacing:n.itemSpacing},designSystem:i,dependencies:[],interactions:{},elements:[]}})),r=n=>e(void 0,void 0,void 0,(function*(){return{screens:n,timestamp:(new Date).toISOString()}}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVUsa0JBR3ZFLENBQ0EsUUFDSWhCLEVBQU1FLGFBQWMsRUFDcEJGLEVBQU1HLGNBQWUsQ0FDekIsQ0FDQSxNQUNKLElBQUssbUJBQ0RILEVBQU1HLGNBQWUsRUFDckIsTUFDSixRQUNJVyxRQUFRdUUsSUFBSSx3QkFBeUJ3QixFQUFJckcsTUFFckQsQ0FDQSxNQUFPRixHQUNIUSxRQUFRUixNQUFNLDBCQUEyQkEsR0FDekNNLEVBQVlOLEVBQU8sbUJBQ3ZCLENBQ0osSUFFQUksTUFBTStFLEdBQUcsU0FBUyxLQUNkekYsRUFBTUMsYUFBYyxFQUNwQkQsRUFBTUUsYUFBYyxFQUNwQkYsRUFBTU0sTUFBUSxRQXlJbEIsTUFBTXlHLEVBQWUsQ0FBQzdGLEVBQU9nRCxJQUFpQnBGLE9BQVUsT0FBUSxPQUFRLEdBQVEsWUFFNUUsTUFBTyxDQUNIK0MsR0FBSVgsRUFBTVcsR0FDVkMsS0FBTVosRUFBTVksS0FDWkssV0FBWSxDQUNSQyxNQUFPbEIsRUFBTWtCLE1BQ2JDLE9BQVFuQixFQUFNbUIsUUFFbEI0QixPQUFRLENBQ0ppRCxXQUFZaEcsRUFBTWdHLFdBQ2xCQyxzQkFBdUJqRyxFQUFNaUcsc0JBQzdCQyxzQkFBdUJsRyxFQUFNa0csc0JBQzdCQyxRQUFTbkcsRUFBTW9HLFdBQWEsQ0FDeEJDLElBQUtyRyxFQUFNb0csV0FDWEUsTUFBT3RHLEVBQU11RyxhQUNiQyxPQUFReEcsRUFBTXlHLGNBQ2RDLEtBQU0xRyxFQUFNMkcsa0JBQ1pDLEVBQ0pDLFlBQWE3RyxFQUFNNkcsYUFFdkI3RCxlQUNBOUMsYUFBYyxHQUNkRSxhQUFjLENBQUMsRUFDZkgsU0FBVSxHQUVsQixJQUNNOEYsRUFBc0I1RyxHQUFnQnZCLE9BQVUsT0FBUSxPQUFRLEdBQVEsWUFFMUUsTUFBTyxDQUNIa0osUUFBUzNILEVBQ1Q0SCxXQUFXLElBQUlDLE1BQU9DLGNBRTlCLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kZXNpZ24yZGV2LXBsdWdpbi8uL3NyYy9wbHVnaW4vY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvcGx1Z2luL2NvbnRyb2xsZXIudHNcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuLy8gQ29uc3RhbnRzXG5jb25zdCBQTFVHSU5fVUlfV0lEVEggPSA0MDA7XG5jb25zdCBQTFVHSU5fVUlfSEVJR0hUID0gNjAwO1xuY29uc3QgTUFYX1NFTEVDVElPTl9TSVpFID0gODtcbmNvbnN0IE1JTl9TRUxFQ1RJT05fU0laRSA9IDE7XG5jb25zdCBBUElfS0VZID0gJ2QyZDEnOyAvLyBIYXJkY29kZWQgZm9yIHRlc3RpbmdcbmNvbnN0IFNFUlZFUl9VUkwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwJztcbmNvbnN0IHN0YXRlID0ge1xuICAgIGlzQW5hbHl6aW5nOiBmYWxzZSxcbiAgICBpc0V4cG9ydGluZzogZmFsc2UsXG4gICAgc2hvdWxkQ2FuY2VsOiBmYWxzZSxcbiAgICBzZWxlY3RlZERlc2lnblN5c3RlbTogJ3JlYWN0LW5hdGl2ZS1wYXBlcicsXG4gICAgc2NyZWVuU3BlY3M6IFtdLFxuICAgIGVycm9yOiBudWxsXG59O1xuLy8gSW5pdGlhbGl6ZSBwbHVnaW4gVUlcbmZpZ21hLnNob3dVSShfX2h0bWxfXywge1xuICAgIHdpZHRoOiBQTFVHSU5fVUlfV0lEVEgsXG4gICAgaGVpZ2h0OiBQTFVHSU5fVUlfSEVJR0hUXG59KTtcbi8vIFNlbmQgaW5pdGlhbCBzdGF0ZVxuY29uc29sZS5sb2coJ1NlbmRpbmcgaW5pdGlhbCBzdGF0ZScpO1xucG9zdE1lc3NhZ2UoJ1BMVUdJTl9SRUFEWScpO1xucG9zdE1lc3NhZ2UoJ1BBR0VfSU5GTycsIHtcbiAgICBuYW1lOiBmaWdtYS5jdXJyZW50UGFnZS5uYW1lLFxuICAgIG5vZGVDb3VudDogZmlnbWEuY3VycmVudFBhZ2UuY2hpbGRyZW4ubGVuZ3RoXG59KTtcbi8vIFV0aWxpdHkgZnVuY3Rpb25zXG5mdW5jdGlvbiBwb3N0TWVzc2FnZSh0eXBlLCBwYXlsb2FkKSB7XG4gICAgZmlnbWEudWkucG9zdE1lc3NhZ2UoeyB0eXBlLCBwYXlsb2FkIH0pO1xufVxuLy8gRXJyb3IgaGFuZGxpbmdcbmZ1bmN0aW9uIGhhbmRsZUVycm9yKGVycm9yLCBjb250ZXh0KSB7XG4gICAgY29uc29sZS5lcnJvcihgRXJyb3IgaW4gJHtjb250ZXh0fTpgLCBlcnJvcik7XG4gICAgc3RhdGUuZXJyb3IgPSBlcnJvcjtcbiAgICBmaWdtYS5ub3RpZnkoYEVycm9yIGluICR7Y29udGV4dH06ICR7ZXJyb3IubWVzc2FnZX1gLCB7IGVycm9yOiB0cnVlIH0pO1xufVxuLy8gQWRkIGZyYW1lVG9TY3JlZW5TcGVjIGZ1bmN0aW9uXG5mdW5jdGlvbiBmcmFtZVRvU2NyZWVuU3BlYyhmcmFtZSkge1xuICAgIGNvbnN0IGVsZW1lbnRzID0gW107XG4gICAgY29uc3QgZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpO1xuICAgIGNvbnN0IGludGVyYWN0aW9ucyA9IG5ldyBNYXAoKTtcbiAgICAvLyBBbmFseXplIGFsbCBub2RlcyBpbiB0aGUgZnJhbWVcbiAgICBmcmFtZS5maW5kQWxsKChub2RlKSA9PiB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIC8vIEV4dHJhY3QgZWxlbWVudCBpbmZvcm1hdGlvblxuICAgICAgICBjb25zdCBlbGVtZW50ID0ge1xuICAgICAgICAgICAgaWQ6IG5vZGUuaWQsXG4gICAgICAgICAgICBuYW1lOiBub2RlLm5hbWUsXG4gICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IG5vZGUueCwgeTogbm9kZS55IH0sXG4gICAgICAgICAgICBkaW1lbnNpb25zOiB7IHdpZHRoOiBub2RlLndpZHRoLCBoZWlnaHQ6IG5vZGUuaGVpZ2h0IH0sXG4gICAgICAgICAgICBzdHlsaW5nOiBleHRyYWN0U3R5bGVQcm9wZXJ0aWVzKG5vZGUpLFxuICAgICAgICAgICAgcGFyZW50OiAoX2EgPSBub2RlLnBhcmVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlkLFxuICAgICAgICAgICAgY2hpbGRyZW46ICdjaGlsZHJlbicgaW4gbm9kZSA/IG5vZGUuY2hpbGRyZW4ubWFwKGNoaWxkID0+IGNoaWxkLmlkKSA6IFtdLFxuICAgICAgICAgICAgekluZGV4OiBub2RlLnBhcmVudCA/IG5vZGUucGFyZW50LmNoaWxkcmVuLmluZGV4T2Yobm9kZSkgOiAwXG4gICAgICAgIH07XG4gICAgICAgIC8vIEFkZCBjb250ZW50IGZvciB0ZXh0IG5vZGVzXG4gICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdURVhUJykge1xuICAgICAgICAgICAgZWxlbWVudC5jb250ZW50ID0gbm9kZS5jaGFyYWN0ZXJzO1xuICAgICAgICAgICAgZWxlbWVudC50ZXh0U3R5bGUgPSB7XG4gICAgICAgICAgICAgICAgZm9udEZhbWlseTogaXNGb250TmFtZShub2RlLmZvbnROYW1lKSA/IG5vZGUuZm9udE5hbWUuZmFtaWx5IDogJ0ludGVyJyxcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogdHlwZW9mIG5vZGUuZm9udFNpemUgPT09ICdudW1iZXInID8gbm9kZS5mb250U2l6ZSA6IDE2LFxuICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6IDQwMCxcbiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiB0eXBlb2Ygbm9kZS5saW5lSGVpZ2h0ID09PSAnbnVtYmVyJyA/IG5vZGUubGluZUhlaWdodCA6IDEuMixcbiAgICAgICAgICAgICAgICBsZXR0ZXJTcGFjaW5nOiB0eXBlb2Ygbm9kZS5sZXR0ZXJTcGFjaW5nID09PSAnbnVtYmVyJyA/IG5vZGUubGV0dGVyU3BhY2luZyA6IDAsXG4gICAgICAgICAgICAgICAgdGV4dEFsaWduOiAoKF9iID0gbm9kZS50ZXh0QWxpZ25Ib3Jpem9udGFsKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudG9Mb3dlckNhc2UoKSkgfHwgJ2xlZnQnLFxuICAgICAgICAgICAgICAgIGNvbG9yOiAnIzAwMDAwMCdcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgLy8gQWRkIGRlcGVuZGVuY2llcyBiYXNlZCBvbiBzdHlsaW5nXG4gICAgICAgIGlmIChlbGVtZW50LnN0eWxpbmcpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0eWxlID0gZWxlbWVudC5zdHlsaW5nOyAvLyBUeXBlIGFzc2VydGlvbiBmb3Igc2hhZG93IHByb3BlcnRpZXNcbiAgICAgICAgICAgIGlmIChzdHlsZS5zaGFkb3dDb2xvciB8fCBzdHlsZS5zaGFkb3dPZmZzZXQpIHtcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMuYWRkKCdyZWFjdC1uYXRpdmUtc2hhZG93LTInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdHlsZS5hbmltYXRpb24pIHtcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMuYWRkKCdyZWFjdC1uYXRpdmUtcmVhbmltYXRlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsZW1lbnRzLnB1c2goZWxlbWVudCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgICBpZDogYHNjcmVlbi0ke2ZyYW1lLmlkfWAsXG4gICAgICAgIG5hbWU6IGZyYW1lLm5hbWUsXG4gICAgICAgIGRpbWVuc2lvbnM6IHsgd2lkdGg6IGZyYW1lLndpZHRoLCBoZWlnaHQ6IGZyYW1lLmhlaWdodCB9LFxuICAgICAgICBsYXlvdXQ6IGV4dHJhY3RTdHlsZVByb3BlcnRpZXMoZnJhbWUpLFxuICAgICAgICBkZXNpZ25TeXN0ZW06IHN0YXRlLnNlbGVjdGVkRGVzaWduU3lzdGVtLFxuICAgICAgICBlbGVtZW50cyxcbiAgICAgICAgZGVwZW5kZW5jaWVzOiBBcnJheS5mcm9tKGRlcGVuZGVuY2llcyksXG4gICAgICAgIGludGVyYWN0aW9uczogT2JqZWN0LmZyb21FbnRyaWVzKGludGVyYWN0aW9ucylcbiAgICB9O1xufVxuZnVuY3Rpb24gYW5hbHl6ZVNjcmVlbnMoZnJhbWVzKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHNjcmVlblNwZWNzID0gZnJhbWVzLm1hcChmcmFtZVRvU2NyZWVuU3BlYyk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0geWllbGQgUHJvbWlzZS5hbGwoc2NyZWVuU3BlY3MubWFwKChzY3JlZW4pID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGZldGNoKGAke1NFUlZFUl9VUkx9L2FwaS9hbmFseXplYCwge1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke0FQSV9LRVl9YFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW4sXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNpZ25TeXN0ZW06IHN0YXRlLnNlbGVjdGVkRGVzaWduU3lzdGVtXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFuYWx5c2lzIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignQW5hbHlzaXMgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbi8vIExpc3RlbiBmb3Igc2VsZWN0aW9uIGNoYW5nZXNcbmZpZ21hLm9uKCdzZWxlY3Rpb25jaGFuZ2UnLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjb25zdCBzZWxlY3Rpb24gPSBmaWdtYS5jdXJyZW50UGFnZS5zZWxlY3Rpb247XG4gICAgaWYgKHNlbGVjdGlvbi5sZW5ndGggPiAwICYmIHNlbGVjdGlvbi5sZW5ndGggPD0gTUFYX1NFTEVDVElPTl9TSVpFKSB7XG4gICAgICAgIGNvbnN0IGZyYW1lcyA9IHNlbGVjdGlvbi5maWx0ZXIobm9kZSA9PiBub2RlLnR5cGUgPT09ICdGUkFNRScpO1xuICAgICAgICBpZiAoZnJhbWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgc3RhdGUuaXNBbmFseXppbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlKCdBTkFMWVNJU19TVEFSVEVEJyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2NyZWVuU3BlY3MgPSB5aWVsZCBhbmFseXplU2NyZWVucyhmcmFtZXMpO1xuICAgICAgICAgICAgICAgIHN0YXRlLnNjcmVlblNwZWNzID0gc2NyZWVuU3BlY3M7XG4gICAgICAgICAgICAgICAgcG9zdE1lc3NhZ2UoJ0FOQUxZU0lTX0NPTVBMRVRFJywge1xuICAgICAgICAgICAgICAgICAgICBzY3JlZW5TcGVjcyxcbiAgICAgICAgICAgICAgICAgICAgZGVzaWduU3lzdGVtOiBzdGF0ZS5zZWxlY3RlZERlc2lnblN5c3RlbVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlRXJyb3IoZXJyb3IsICdhbmFseXNpcycpO1xuICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlKCdBTkFMWVNJU19GQUlMRUQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIHN0YXRlLmlzQW5hbHl6aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSk7XG4vLyBNZXNzYWdlIGhhbmRsaW5nXG5maWdtYS51aS5vbm1lc3NhZ2UgPSAobXNnKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjb25zb2xlLmxvZygnUGx1Z2luIHJlY2VpdmVkIG1lc3NhZ2U6JywgbXNnKTtcbiAgICB0cnkge1xuICAgICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdJTklUJzoge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZWNlaXZlZCBJTklUIG1lc3NhZ2UsIHNlbmRpbmcgUExVR0lOX1JFQURZJyk7XG4gICAgICAgICAgICAgICAgcG9zdE1lc3NhZ2UoJ1BMVUdJTl9SRUFEWScpO1xuICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlKCdQQUdFX0lORk8nLCB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGZpZ21hLmN1cnJlbnRQYWdlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIG5vZGVDb3VudDogZmlnbWEuY3VycmVudFBhZ2UuY2hpbGRyZW4ubGVuZ3RoXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdBTkFMWVpFX1NDUkVFTlMnOlxuICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5pc0FuYWx5emluZyB8fCBzdGF0ZS5pc0V4cG9ydGluZykge1xuICAgICAgICAgICAgICAgICAgICBmaWdtYS51aS5wb3N0TWVzc2FnZSh7IHR5cGU6ICdBTkFMWVNJU19FUlJPUicsIHBheWxvYWQ6IHsgZXJyb3I6ICdBbm90aGVyIG9wZXJhdGlvbiBpcyBpbiBwcm9ncmVzcycgfSB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdGF0ZS5pc0FuYWx5emluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgc3RhdGUuc2hvdWxkQ2FuY2VsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZmlnbWEuY3VycmVudFBhZ2Uuc2VsZWN0aW9uO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0aW9uLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2Ugc2VsZWN0IGF0IGxlYXN0IG9uZSBmcmFtZSB0byBhbmFseXplJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi5sZW5ndGggPiA4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BsZWFzZSBzZWxlY3Qgbm8gbW9yZSB0aGFuIDggZnJhbWVzJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnJhbWVzID0gc2VsZWN0aW9uLmZpbHRlcihub2RlID0+IG5vZGUudHlwZSA9PT0gJ0ZSQU1FJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmcmFtZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BsZWFzZSBzZWxlY3QgdmFsaWQgZnJhbWVzIHRvIGFuYWx5emUnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmaWdtYS51aS5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQU5BTFlTSVNfUFJPR1JFU1MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZDogeyBtZXNzYWdlOiAnQW5hbHl6aW5nIGZyYW1lcy4uLicgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NyZWVuU3BlY3MgPSB5aWVsZCBQcm9taXNlLmFsbChmcmFtZXMubWFwKChmcmFtZSwgaW5kZXgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNob3VsZENhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQW5hbHlzaXMgY2FuY2VsbGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWdtYS51aS5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0FOQUxZU0lTX1BST0dSRVNTJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7IG1lc3NhZ2U6IGBBbmFseXppbmcgZnJhbWUgJHtpbmRleCArIDF9IG9mICR7ZnJhbWVzLmxlbmd0aH0uLi5gIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BlYyA9IHlpZWxkIGFuYWx5emVGcmFtZShmcmFtZSwgbXNnLnBheWxvYWQuZGVzaWduU3lzdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzcGVjO1xuICAgICAgICAgICAgICAgICAgICB9KSkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuc2hvdWxkQ2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FuYWx5c2lzIGNhbmNlbGxlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZpZ21hLnVpLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdBTkFMWVNJU19QUk9HUkVTUycsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7IG1lc3NhZ2U6ICdGaW5hbGl6aW5nIGFuYWx5c2lzLi4uJyB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmaWdtYS51aS5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQU5BTFlTSVNfQ09NUExFVEUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZDogeyBzY3JlZW5TcGVjcyB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5zaG91bGRDYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZ21hLnVpLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQU5BTFlTSVNfRVJST1InLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZS5pc0FuYWx5emluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zaG91bGRDYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdFWFBPUlRfQlVORExFJzpcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaXNBbmFseXppbmcgfHwgc3RhdGUuaXNFeHBvcnRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlnbWEudWkucG9zdE1lc3NhZ2UoeyB0eXBlOiAnRVhQT1JUX0VSUk9SJywgcGF5bG9hZDogeyBlcnJvcjogJ0Fub3RoZXIgb3BlcmF0aW9uIGlzIGluIHByb2dyZXNzJyB9IH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0YXRlLmlzRXhwb3J0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzdGF0ZS5zaG91bGRDYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuc2hvdWxkQ2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cG9ydCBjYW5jZWxsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHNjcmVlblNwZWNzIH0gPSBtc2cucGF5bG9hZDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnVuZGxlID0geWllbGQgY3JlYXRlRXhwb3J0QnVuZGxlKHNjcmVlblNwZWNzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNob3VsZENhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFeHBvcnQgY2FuY2VsbGVkJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZmlnbWEudWkucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0VYUE9SVF9DT01QTEVURScsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7IGJ1bmRsZSB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5zaG91bGRDYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZ21hLnVpLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnRVhQT1JUX0VSUk9SJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7IGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUuaXNFeHBvcnRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUuc2hvdWxkQ2FuY2VsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnQ0FOQ0VMX09QRVJBVElPTic6XG4gICAgICAgICAgICAgICAgc3RhdGUuc2hvdWxkQ2FuY2VsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Vua25vd24gbWVzc2FnZSB0eXBlOicsIG1zZy50eXBlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaGFuZGxpbmcgbWVzc2FnZTonLCBlcnJvcik7XG4gICAgICAgIGhhbmRsZUVycm9yKGVycm9yLCAnbWVzc2FnZSBoYW5kbGluZycpO1xuICAgIH1cbn0pO1xuLy8gQ2xlYW51cCBvbiBwbHVnaW4gY2xvc2VcbmZpZ21hLm9uKCdjbG9zZScsICgpID0+IHtcbiAgICBzdGF0ZS5pc0FuYWx5emluZyA9IGZhbHNlO1xuICAgIHN0YXRlLmlzRXhwb3J0aW5nID0gZmFsc2U7XG4gICAgc3RhdGUuZXJyb3IgPSBudWxsO1xufSk7XG5mdW5jdGlvbiBleHRyYWN0Tm9kZVByb3BlcnRpZXMobm9kZSkge1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSB7fTtcbiAgICBjb25zdCBmaWdtYU5vZGUgPSBub2RlO1xuICAgIC8vIEJhc2ljIHByb3BlcnRpZXNcbiAgICBpZiAodHlwZW9mIGZpZ21hTm9kZS5vcGFjaXR5ID09PSAnbnVtYmVyJykge1xuICAgICAgICBwcm9wZXJ0aWVzLm9wYWNpdHkgPSBmaWdtYU5vZGUub3BhY2l0eTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBmaWdtYU5vZGUudmlzaWJsZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIHByb3BlcnRpZXMudmlzaWJsZSA9IGZpZ21hTm9kZS52aXNpYmxlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGZpZ21hTm9kZS5yb3RhdGlvbiA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgcHJvcGVydGllcy5yb3RhdGlvbiA9IGZpZ21hTm9kZS5yb3RhdGlvbjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBmaWdtYU5vZGUuYmxlbmRNb2RlID09PSAnc3RyaW5nJykge1xuICAgICAgICBwcm9wZXJ0aWVzLmJsZW5kTW9kZSA9IGZpZ21hTm9kZS5ibGVuZE1vZGU7XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KGZpZ21hTm9kZS5lZmZlY3RzKSkge1xuICAgICAgICBwcm9wZXJ0aWVzLmVmZmVjdHMgPSBmaWdtYU5vZGUuZWZmZWN0c1xuICAgICAgICAgICAgLmZpbHRlcigoZWZmZWN0KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZWZmZWN0LnR5cGUgPT09ICdEUk9QX1NIQURPVycgfHwgZWZmZWN0LnR5cGUgPT09ICdJTk5FUl9TSEFET1cnIHx8IGVmZmVjdC50eXBlID09PSAnTEFZRVJfQkxVUicgfHwgZWZmZWN0LnR5cGUgPT09ICdCQUNLR1JPVU5EX0JMVVInO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm1hcChlZmZlY3QgPT4gKHtcbiAgICAgICAgICAgIHR5cGU6IGVmZmVjdC50eXBlLFxuICAgICAgICAgICAgdmlzaWJsZTogZWZmZWN0LnZpc2libGUsXG4gICAgICAgICAgICBjb2xvcjogZWZmZWN0LmNvbG9yLFxuICAgICAgICAgICAgb2Zmc2V0OiBlZmZlY3Qub2Zmc2V0LFxuICAgICAgICAgICAgcmFkaXVzOiBlZmZlY3QucmFkaXVzLFxuICAgICAgICAgICAgc3ByZWFkOiBlZmZlY3Quc3ByZWFkLFxuICAgICAgICAgICAgYmxlbmRNb2RlOiBlZmZlY3QuYmxlbmRNb2RlIHx8ICdOT1JNQUwnXG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLy8gTGF5b3V0IHByb3BlcnRpZXNcbiAgICBpZiAodHlwZW9mIGZpZ21hTm9kZS5sYXlvdXRNb2RlID09PSAnc3RyaW5nJykge1xuICAgICAgICBjb25zdCBtb2RlID0gZmlnbWFOb2RlLmxheW91dE1vZGU7XG4gICAgICAgIGlmIChtb2RlID09PSAnTk9ORScgfHwgbW9kZSA9PT0gJ0hPUklaT05UQUwnIHx8IG1vZGUgPT09ICdWRVJUSUNBTCcpIHtcbiAgICAgICAgICAgIHByb3BlcnRpZXMubGF5b3V0TW9kZSA9IG1vZGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBmaWdtYU5vZGUucHJpbWFyeUF4aXNTaXppbmdNb2RlID09PSAnc3RyaW5nJykge1xuICAgICAgICBjb25zdCBtb2RlID0gZmlnbWFOb2RlLnByaW1hcnlBeGlzU2l6aW5nTW9kZTtcbiAgICAgICAgaWYgKG1vZGUgPT09ICdGSVhFRCcgfHwgbW9kZSA9PT0gJ0FVVE8nKSB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLnByaW1hcnlBeGlzU2l6aW5nTW9kZSA9IG1vZGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBmaWdtYU5vZGUuY291bnRlckF4aXNTaXppbmdNb2RlID09PSAnc3RyaW5nJykge1xuICAgICAgICBjb25zdCBtb2RlID0gZmlnbWFOb2RlLmNvdW50ZXJBeGlzU2l6aW5nTW9kZTtcbiAgICAgICAgaWYgKG1vZGUgPT09ICdGSVhFRCcgfHwgbW9kZSA9PT0gJ0FVVE8nKSB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLmNvdW50ZXJBeGlzU2l6aW5nTW9kZSA9IG1vZGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHByb3BlcnRpZXM7XG59XG4vLyBBZGQgaGVscGVyIGZ1bmN0aW9uc1xuZnVuY3Rpb24gZXh0cmFjdFN0eWxlUHJvcGVydGllcyhub2RlKSB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9IHt9O1xuICAgIGlmICgnb3BhY2l0eScgaW4gbm9kZSlcbiAgICAgICAgcHJvcGVydGllcy5vcGFjaXR5ID0gbm9kZS5vcGFjaXR5O1xuICAgIGlmICgndmlzaWJsZScgaW4gbm9kZSlcbiAgICAgICAgcHJvcGVydGllcy52aXNpYmxlID0gbm9kZS52aXNpYmxlO1xuICAgIGlmICgncm90YXRpb24nIGluIG5vZGUpXG4gICAgICAgIHByb3BlcnRpZXMucm90YXRpb24gPSBub2RlLnJvdGF0aW9uO1xuICAgIGlmICgnYmxlbmRNb2RlJyBpbiBub2RlKVxuICAgICAgICBwcm9wZXJ0aWVzLmJsZW5kTW9kZSA9IG5vZGUuYmxlbmRNb2RlO1xuICAgIGlmICgnZWZmZWN0cycgaW4gbm9kZSkge1xuICAgICAgICBwcm9wZXJ0aWVzLmVmZmVjdHMgPSBub2RlLmVmZmVjdHMubWFwKGVmZmVjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCBiYXNlRWZmZWN0ID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6IGVmZmVjdC50eXBlLFxuICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgICAgICAgICAgYmxlbmRNb2RlOiAnTk9STUFMJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICgnY29sb3InIGluIGVmZmVjdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGJhc2VFZmZlY3QpLCB7IGNvbG9yOiBlZmZlY3QuY29sb3IsIG9mZnNldDogZWZmZWN0Lm9mZnNldCwgcmFkaXVzOiBlZmZlY3QucmFkaXVzLCBzcHJlYWQ6IGVmZmVjdC5zcHJlYWQgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJ3JhZGl1cycgaW4gZWZmZWN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgYmFzZUVmZmVjdCksIHsgcmFkaXVzOiBlZmZlY3QucmFkaXVzIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGJhc2VFZmZlY3Q7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcHJvcGVydGllcztcbn1cbmZ1bmN0aW9uIGlzRm9udE5hbWUodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiAnZmFtaWx5JyBpbiB2YWx1ZTtcbn1cbi8vIEFkZCBkZXBlbmRlbmN5IGRldGVjdGlvbiBmdW5jdGlvblxuZnVuY3Rpb24gZGV0ZWN0RGVwZW5kZW5jaWVzKHNjcmVlbikge1xuICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IG5ldyBTZXQoKTtcbiAgICAvLyBBZGQgYmFzZSBkZXBlbmRlbmNpZXMgYmFzZWQgb24gZGVzaWduIHN5c3RlbVxuICAgIHN3aXRjaCAoc3RhdGUuc2VsZWN0ZWREZXNpZ25TeXN0ZW0pIHtcbiAgICAgICAgY2FzZSAncmVhY3QtbmF0aXZlLXBhcGVyJzpcbiAgICAgICAgICAgIGRlcGVuZGVuY2llcy5hZGQoJ3JlYWN0LW5hdGl2ZS1wYXBlcicpO1xuICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmFkZCgncmVhY3QtbmF0aXZlLXNhZmUtYXJlYS1jb250ZXh0Jyk7XG4gICAgICAgICAgICBkZXBlbmRlbmNpZXMuYWRkKCdyZWFjdC1uYXRpdmUtdmVjdG9yLWljb25zJyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncmVhY3QtbmF0aXZlLWVsZW1lbnRzJzpcbiAgICAgICAgICAgIGRlcGVuZGVuY2llcy5hZGQoJ0BybmV1aS90aGVtZWQnKTtcbiAgICAgICAgICAgIGRlcGVuZGVuY2llcy5hZGQoJ0BybmV1aS9iYXNlJyk7XG4gICAgICAgICAgICBkZXBlbmRlbmNpZXMuYWRkKCdyZWFjdC1uYXRpdmUtdmVjdG9yLWljb25zJyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbmF0aXZlLWJhc2UnOlxuICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmFkZCgnbmF0aXZlLWJhc2UnKTtcbiAgICAgICAgICAgIGRlcGVuZGVuY2llcy5hZGQoJ3JlYWN0LW5hdGl2ZS1zdmcnKTtcbiAgICAgICAgICAgIGRlcGVuZGVuY2llcy5hZGQoJ3JlYWN0LW5hdGl2ZS1zYWZlLWFyZWEtY29udGV4dCcpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIC8vIEFkZCBkZXBlbmRlbmNpZXMgYmFzZWQgb24gY29tcG9uZW50IHR5cGVzXG4gICAgc2NyZWVuLmVsZW1lbnRzLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIHN3aXRjaCAoZWxlbWVudC50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdpbWFnZSc6XG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmFkZCgncmVhY3QtbmF0aXZlLWZhc3QtaW1hZ2UnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3ZlY3Rvcic6XG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmFkZCgncmVhY3QtbmF0aXZlLXN2ZycpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndGV4dCc6XG4gICAgICAgICAgICAgICAgaWYgKChfYiA9IChfYSA9IGVsZW1lbnQudGV4dFN0eWxlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9udEZhbWlseSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmluY2x1ZGVzKCdNYXRlcmlhbCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llcy5hZGQoJ3JlYWN0LW5hdGl2ZS12ZWN0b3ItaWNvbnMnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQWRkIGRlcGVuZGVuY2llcyBiYXNlZCBvbiBzdHlsaW5nXG4gICAgICAgIGlmIChlbGVtZW50LnN0eWxpbmcpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0eWxlID0gZWxlbWVudC5zdHlsaW5nOyAvLyBUeXBlIGFzc2VydGlvbiBmb3Igc2hhZG93IHByb3BlcnRpZXNcbiAgICAgICAgICAgIGlmIChzdHlsZS5zaGFkb3dDb2xvciB8fCBzdHlsZS5zaGFkb3dPZmZzZXQpIHtcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMuYWRkKCdyZWFjdC1uYXRpdmUtc2hhZG93LTInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdHlsZS5hbmltYXRpb24pIHtcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMuYWRkKCdyZWFjdC1uYXRpdmUtcmVhbmltYXRlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIEFycmF5LmZyb20oZGVwZW5kZW5jaWVzKTtcbn1cbi8vIFVwZGF0ZSBmdW5jdGlvbiBuYW1lc1xuY29uc3QgYW5hbHl6ZUZyYW1lID0gKGZyYW1lLCBkZXNpZ25TeXN0ZW0pID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIC8vIEltcGxlbWVudGF0aW9uIG9mIGZyYW1lIGFuYWx5c2lzXG4gICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGZyYW1lLmlkLFxuICAgICAgICBuYW1lOiBmcmFtZS5uYW1lLFxuICAgICAgICBkaW1lbnNpb25zOiB7XG4gICAgICAgICAgICB3aWR0aDogZnJhbWUud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IGZyYW1lLmhlaWdodFxuICAgICAgICB9LFxuICAgICAgICBsYXlvdXQ6IHtcbiAgICAgICAgICAgIGxheW91dE1vZGU6IGZyYW1lLmxheW91dE1vZGUsXG4gICAgICAgICAgICBwcmltYXJ5QXhpc0FsaWduSXRlbXM6IGZyYW1lLnByaW1hcnlBeGlzQWxpZ25JdGVtcyxcbiAgICAgICAgICAgIGNvdW50ZXJBeGlzQWxpZ25JdGVtczogZnJhbWUuY291bnRlckF4aXNBbGlnbkl0ZW1zLFxuICAgICAgICAgICAgcGFkZGluZzogZnJhbWUucGFkZGluZ1RvcCA/IHtcbiAgICAgICAgICAgICAgICB0b3A6IGZyYW1lLnBhZGRpbmdUb3AsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IGZyYW1lLnBhZGRpbmdSaWdodCxcbiAgICAgICAgICAgICAgICBib3R0b206IGZyYW1lLnBhZGRpbmdCb3R0b20sXG4gICAgICAgICAgICAgICAgbGVmdDogZnJhbWUucGFkZGluZ0xlZnRcbiAgICAgICAgICAgIH0gOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBpdGVtU3BhY2luZzogZnJhbWUuaXRlbVNwYWNpbmdcbiAgICAgICAgfSxcbiAgICAgICAgZGVzaWduU3lzdGVtLFxuICAgICAgICBkZXBlbmRlbmNpZXM6IFtdLFxuICAgICAgICBpbnRlcmFjdGlvbnM6IHt9LFxuICAgICAgICBlbGVtZW50czogW10gLy8gQWRkIGVsZW1lbnQgYW5hbHlzaXMgbG9naWMgaGVyZVxuICAgIH07XG59KTtcbmNvbnN0IGNyZWF0ZUV4cG9ydEJ1bmRsZSA9IChzY3JlZW5TcGVjcykgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgLy8gSW1wbGVtZW50YXRpb24gb2YgZXhwb3J0IGJ1bmRsZSBnZW5lcmF0aW9uXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2NyZWVuczogc2NyZWVuU3BlY3MsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfTtcbn0pO1xuZXhwb3J0IHt9O1xuIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJzdGF0ZSIsImlzQW5hbHl6aW5nIiwiaXNFeHBvcnRpbmciLCJzaG91bGRDYW5jZWwiLCJzZWxlY3RlZERlc2lnblN5c3RlbSIsInNjcmVlblNwZWNzIiwiZXJyb3IiLCJwb3N0TWVzc2FnZSIsInR5cGUiLCJwYXlsb2FkIiwiZmlnbWEiLCJ1aSIsImhhbmRsZUVycm9yIiwiY29udGV4dCIsImNvbnNvbGUiLCJub3RpZnkiLCJtZXNzYWdlIiwiZnJhbWVUb1NjcmVlblNwZWMiLCJmcmFtZSIsImVsZW1lbnRzIiwiZGVwZW5kZW5jaWVzIiwiU2V0IiwiaW50ZXJhY3Rpb25zIiwiTWFwIiwiZmluZEFsbCIsIm5vZGUiLCJfYSIsIl9iIiwiZWxlbWVudCIsImlkIiwibmFtZSIsInRvTG93ZXJDYXNlIiwicG9zaXRpb24iLCJ4IiwieSIsImRpbWVuc2lvbnMiLCJ3aWR0aCIsImhlaWdodCIsInN0eWxpbmciLCJleHRyYWN0U3R5bGVQcm9wZXJ0aWVzIiwicGFyZW50IiwiY2hpbGRyZW4iLCJtYXAiLCJjaGlsZCIsInpJbmRleCIsImluZGV4T2YiLCJjb250ZW50IiwiY2hhcmFjdGVycyIsInRleHRTdHlsZSIsImZvbnRGYW1pbHkiLCJmb250TmFtZSIsImZhbWlseSIsImZvbnRTaXplIiwiZm9udFdlaWdodCIsImxpbmVIZWlnaHQiLCJsZXR0ZXJTcGFjaW5nIiwidGV4dEFsaWduIiwidGV4dEFsaWduSG9yaXpvbnRhbCIsImNvbG9yIiwic3R5bGUiLCJzaGFkb3dDb2xvciIsInNoYWRvd09mZnNldCIsImFkZCIsImFuaW1hdGlvbiIsInB1c2giLCJsYXlvdXQiLCJkZXNpZ25TeXN0ZW0iLCJBcnJheSIsImZyb20iLCJPYmplY3QiLCJmcm9tRW50cmllcyIsInByb3BlcnRpZXMiLCJvcGFjaXR5IiwidmlzaWJsZSIsInJvdGF0aW9uIiwiYmxlbmRNb2RlIiwiZWZmZWN0cyIsImVmZmVjdCIsImJhc2VFZmZlY3QiLCJhc3NpZ24iLCJvZmZzZXQiLCJyYWRpdXMiLCJzcHJlYWQiLCJzaG93VUkiLCJfX2h0bWxfXyIsImxvZyIsImN1cnJlbnRQYWdlIiwibm9kZUNvdW50IiwibGVuZ3RoIiwib24iLCJzZWxlY3Rpb24iLCJmcmFtZXMiLCJmaWx0ZXIiLCJ0aGlzIiwiYWxsIiwic2NyZWVuIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm9rIiwiRXJyb3IiLCJzdGF0dXNUZXh0IiwianNvbiIsImFuYWx5emVTY3JlZW5zIiwib25tZXNzYWdlIiwibXNnIiwiaW5kZXgiLCJhbmFseXplRnJhbWUiLCJidW5kbGUiLCJjcmVhdGVFeHBvcnRCdW5kbGUiLCJsYXlvdXRNb2RlIiwicHJpbWFyeUF4aXNBbGlnbkl0ZW1zIiwiY291bnRlckF4aXNBbGlnbkl0ZW1zIiwicGFkZGluZyIsInBhZGRpbmdUb3AiLCJ0b3AiLCJyaWdodCIsInBhZGRpbmdSaWdodCIsImJvdHRvbSIsInBhZGRpbmdCb3R0b20iLCJsZWZ0IiwicGFkZGluZ0xlZnQiLCJ1bmRlZmluZWQiLCJpdGVtU3BhY2luZyIsInNjcmVlbnMiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciXSwic291cmNlUm9vdCI6IiJ9