(()=>{"use strict";function e(e){const t={};return"layoutMode"in e&&(t.layoutMode=e.layoutMode,t.primaryAlign=e.primaryAxisAlignItems,t.counterAlign=e.counterAxisAlignItems,t.padding={top:e.paddingTop,right:e.paddingRight,bottom:e.paddingBottom,left:e.paddingLeft},t.itemSpacing=e.itemSpacing),"fills"in e&&Array.isArray(e.fills)&&(t.fills=e.fills.map((e=>"SOLID"===e.type?{r:e.color.r,g:e.color.g,b:e.color.b,a:e.opacity}:"GRADIENT_LINEAR"===e.type||"GRADIENT_RADIAL"===e.type?{type:"GRADIENT_LINEAR"===e.type?"LINEAR":"RADIAL",stops:e.gradientStops.map((e=>({color:{r:e.color.r,g:e.color.g,b:e.color.b,a:e.color.a},position:e.position})))}:null)).filter(Boolean)),"strokes"in e&&Array.isArray(e.strokes)&&(t.strokes=e.strokes.map((e=>"SOLID"===e.type?{r:e.color.r,g:e.color.g,b:e.color.b,a:e.opacity}:null)).filter(Boolean),t.strokeWeight="number"==typeof e.strokeWeight?e.strokeWeight:0),"cornerRadius"in e&&("number"==typeof e.cornerRadius?t.cornerRadius=e.cornerRadius:e.cornerRadius!==figma.mixed&&"topLeftRadius"in e&&(t.cornerRadius={topLeft:e.topLeftRadius,topRight:e.topRightRadius,bottomLeft:e.bottomLeftRadius,bottomRight:e.bottomRightRadius})),"opacity"in e&&(t.opacity=e.opacity),"effects"in e&&Array.isArray(e.effects)&&(t.effects=e.effects.map((e=>{var t,n,i,o,r,s,a,l,c,d,p,y,g;return"DROP_SHADOW"===e.type||"INNER_SHADOW"===e.type?{type:e.type,color:{r:null!==(n=null===(t=e.color)||void 0===t?void 0:t.r)&&void 0!==n?n:0,g:null!==(o=null===(i=e.color)||void 0===i?void 0:i.g)&&void 0!==o?o:0,b:null!==(s=null===(r=e.color)||void 0===r?void 0:r.b)&&void 0!==s?s:0,a:null!==(a=e.opacity)&&void 0!==a?a:1},offset:{x:null!==(c=null===(l=e.offset)||void 0===l?void 0:l.x)&&void 0!==c?c:0,y:null!==(p=null===(d=e.offset)||void 0===d?void 0:d.y)&&void 0!==p?p:0},blur:null!==(y=e.radius)&&void 0!==y?y:0,spread:null!==(g=e.spread)&&void 0!==g?g:0}:null})).filter((e=>null!==e))),t}new Map;const t={isAnalyzing:!1,isExporting:!1,lastError:null,selectedDesignSystem:"Custom"};function n(e,t){figma.ui.postMessage({type:e,payload:t})}function i(e,n){console.error(`Error in ${n}:`,e),t.lastError=e.message,figma.notify(`Error in ${n}: ${e.message}`,{error:!0})}figma.showUI(__html__,{width:400,height:600}),figma.ui.onmessage=o=>{return r=void 0,s=void 0,l=function*(){var r;try{switch(o.type){case"ANALYZE_SCREENS":{if(t.isAnalyzing)throw new Error("Analysis already in progress");const s=figma.currentPage.selection.filter((e=>"FRAME"===e.type));if(s.length<1)throw new Error("Please select at least 1 frame to analyze.");if(s.length>8)throw new Error("Please select no more than 8 frames to analyze.");(null===(r=o.payload)||void 0===r?void 0:r.designSystem)&&(t.selectedDesignSystem=o.payload.designSystem),t.isAnalyzing=!0,n("ANALYSIS_STARTED");try{n("ANALYSIS_COMPLETE",{screenSpecs:function(t,n){try{const i=[];for(const o of t){if("FRAME"!==o.type)continue;const t=[],r=new Set,s=new Set,a=new Set;o.findAll((n=>{const i={id:n.id,name:n.name,type:n.type.toLowerCase(),position:{x:n.x,y:n.y},dimensions:{width:n.width,height:n.height},styling:e(n)};"TEXT"===n.type&&(i.content=n.characters),"children"in n&&(i.children=n.children.map((e=>e.id))),"layoutMode"in n&&"NONE"!==n.layoutMode&&(i.autoLayout={direction:n.layoutMode,alignment:n.primaryAxisAlignItems,spacing:n.itemSpacing,padding:{top:n.paddingTop,right:n.paddingRight,bottom:n.paddingBottom,left:n.paddingLeft}}),"effects"in n&&Array.isArray(n.effects)&&n.effects.length>0&&(i.effects=n.effects.map((e=>({type:e.type,properties:e})))),"constraints"in n&&(i.constraints={horizontal:n.constraints.horizontal,vertical:n.constraints.vertical}),t.push(i);const l=n.name.toLowerCase();return l.includes("map")&&r.add("react-native-maps"),(l.includes("camera")||l.includes("avatar-upload"))&&(s.add("android.permission.CAMERA"),s.add("ios.permission.NSCameraUsageDescription")),l.includes("location")&&s.add("android.permission.ACCESS_FINE_LOCATION"),(l.includes("nav")||l.includes("menu"))&&(l.includes("tab")||l.includes("drawer"),"findAll"in n&&"function"==typeof n.findAll&&n.findAll((e=>("FRAME"===e.type&&e!==o&&a.add(e.name),!1)))),!1}));const l={id:`screen-${o.id}`,name:o.name,dimensions:{width:o.width,height:o.height},layout:e(o),designSystem:n,elements:t,dependencies:Array.from(r),permissions:Array.from(s)};a.size>0&&(l.navigation={type:"stack",screens:Array.from(a)}),i.push(l)}return i}catch(e){return console.error("Error analyzing screens:",e),figma.notify("Error analyzing screens. Please try again.",{error:!0}),[]}}(s,t.selectedDesignSystem),designSystem:t.selectedDesignSystem})}catch(e){i(e,"screen analysis"),n("ANALYSIS_FAILED")}finally{t.isAnalyzing=!1}break}case"EXPORT_BUNDLE":{if(t.isExporting)throw new Error("Export already in progress");const{screenSpecs:e}=o.payload;t.isExporting=!0,n("EXPORT_STARTED");try{const i=yield function(e,t){return n=this,i=void 0,r=function*(){try{const n=[],i=[];for(const o of e){n.push({screenName:o.name,designSystem:t,specifications:JSON.stringify(o,null,2),accessibilityRequirements:JSON.stringify({elements:o.elements.map((e=>({id:e.id,name:e.name,type:e.type,role:"text"===e.type?"text":"image"===e.type||"vector"===e.type?"image":"group"})))},null,2)});for(const e of o.elements)if("image"===e.type||"vector"===e.type){const t=figma.getNodeById(e.id);if(t&&"exportAsync"in t){const n=yield t.exportAsync({format:"PNG",constraint:{type:"SCALE",value:2}});i.push({name:`${e.name}.png`,data:n})}}}return{screenSpecs:e,aiPrompts:n,assets:i}}catch(e){throw console.error("Error generating export bundle:",e),figma.notify("Error generating export bundle. Please try again.",{error:!0}),e}},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{l(r.next(e))}catch(e){t(e)}}function a(e){try{l(r.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,a)}l((r=r.apply(n,i||[])).next())}));var n,i,o,r}(e,t.selectedDesignSystem);n("EXPORT_COMPLETE",{bundle:i})}catch(e){i(e,"export"),n("EXPORT_FAILED")}finally{t.isExporting=!1}break}}}catch(e){i(e,"message handling")}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof a?o:new a((function(e){e(o)}))).then(n,i)}o((l=l.apply(r,s||[])).next())}));var r,s,a,l},figma.on("close",(()=>{t.isAnalyzing=!1,t.isExporting=!1,t.lastError=null}))})();