(()=>{"use strict";function e(e){return"object"==typeof e&&null!==e&&"family"in e}function t(e){return"string"==typeof e&&["ORIGINAL","UPPER","LOWER","TITLE","SMALL_CAPS"].includes(e)}function n(e){return"string"==typeof e&&["NONE","UNDERLINE","STRIKETHROUGH"].includes(e)}function i(e){return"string"==typeof e&&["STRETCH","INHERIT","MIN","CENTER","MAX"].includes(e)}function o(e){return"string"==typeof e&&["CENTER","STRETCH","LEFT","RIGHT","SCALE"].includes(e)}function r(e){return"string"==typeof e&&["CENTER","STRETCH","TOP","BOTTOM","SCALE"].includes(e)}new Map;const a={"React Native Paper":{components:["button","card","textinput","checkbox","radio","switch","list","avatar","badge","chip","divider","fab"],styles:["elevation","ripple","paper"]},"Material UI":{components:["mui-button","mui-card","mui-textfield","mui-checkbox","mui-radio","mui-switch","mui-list","mui-avatar"],styles:["mui-elevation","mui-ripple"]},"Chakra UI":{components:["chakra-button","chakra-box","chakra-input","chakra-checkbox","chakra-radio","chakra-switch","chakra-list","chakra-avatar"],styles:["chakra-style","chakra-theme"]},NativeBase:{components:["nb-button","nb-box","nb-input","nb-checkbox","nb-radio","nb-switch","nb-list","nb-avatar"],styles:["nb-style","nb-theme"]}},s={camera:{patterns:["camera","photo","avatar-upload","scan","qr-code"],permissions:{android:["android.permission.CAMERA"],ios:["ios.permission.NSCameraUsageDescription"]}},location:{patterns:["location","map","gps","geolocation"],permissions:{android:["android.permission.ACCESS_FINE_LOCATION","android.permission.ACCESS_COARSE_LOCATION"],ios:["ios.permission.NSLocationWhenInUseUsageDescription"]}},storage:{patterns:["storage","file","download","upload","gallery"],permissions:{android:["android.permission.READ_EXTERNAL_STORAGE","android.permission.WRITE_EXTERNAL_STORAGE"],ios:["ios.permission.NSPhotoLibraryUsageDescription"]}},notifications:{patterns:["notification","push","alert"],permissions:{android:["android.permission.POST_NOTIFICATIONS"],ios:["ios.permission.NSUserNotificationUsageDescription"]}},microphone:{patterns:["microphone","audio","voice","record"],permissions:{android:["android.permission.RECORD_AUDIO"],ios:["ios.permission.NSMicrophoneUsageDescription"]}}},c={"react-native-maps":{patterns:["map","location","gps","geolocation"],version:"^1.7.1"},"react-native-camera":{patterns:["camera","photo","scan","qr-code"],version:"^4.2.1"},"react-native-image-picker":{patterns:["image-picker","photo","gallery","upload"],version:"^5.6.0"},"react-native-vector-icons":{patterns:["icon","material-icon","font-awesome"],version:"^10.0.0"},"react-native-gesture-handler":{patterns:["gesture","swipe","pinch","pan"],version:"^2.12.0"},"react-native-reanimated":{patterns:["animation","transition","motion"],version:"^3.3.0"},"react-native-safe-area-context":{patterns:["safe-area","notch","status-bar"],version:"^4.6.3"}};function l(a){const s={};if("layoutMode"in a&&(s.layoutMode=a.layoutMode,s.primaryAlign=a.primaryAxisAlignItems,s.counterAlign=a.counterAxisAlignItems,s.padding={top:a.paddingTop,right:a.paddingRight,bottom:a.paddingBottom,left:a.paddingLeft},s.itemSpacing=a.itemSpacing,"layoutWrap"in a&&(s.layoutWrap=a.layoutWrap),i(a.layoutAlign)&&(s.layoutAlign=a.layoutAlign),"layoutGrow"in a&&(s.layoutGrow=a.layoutGrow),"layoutPositioning"in a&&(s.layoutPositioning=a.layoutPositioning)),"layoutGrids"in a&&Array.isArray(a.layoutGrids)&&(s.gridLayout=a.layoutGrids.map((e=>({pattern:e.pattern,sectionSize:e.sectionSize,visible:e.visible,color:e.color,alignment:e.alignment,gutterSize:e.gutterSize,count:e.count,offset:e.offset})))),s.position={x:a.x,y:a.y},"rotation"in a&&"number"==typeof a.rotation&&(s.position.rotation=a.rotation),"scaleX"in a&&"scaleY"in a&&"number"==typeof a.scaleX&&"number"==typeof a.scaleY&&(s.position.scale={x:a.scaleX,y:a.scaleY}),"fills"in a&&Array.isArray(a.fills)&&(s.fills=a.fills.map((e=>"SOLID"===e.type?{type:"SOLID",color:{r:e.color.r,g:e.color.g,b:e.color.b,a:e.opacity}}:"GRADIENT_LINEAR"===e.type||"GRADIENT_RADIAL"===e.type?{type:e.type,gradientStops:e.gradientStops,gradientTransform:e.gradientTransform}:"IMAGE"===e.type?{type:"IMAGE",scaleMode:e.scaleMode,imageHash:e.imageHash,blendMode:e.blendMode}:e))),"strokes"in a&&Array.isArray(a.strokes)&&(s.strokes=a.strokes.map((e=>"SOLID"===e.type?{type:"SOLID",color:{r:e.color.r,g:e.color.g,b:e.color.b,a:e.opacity}}:e)),"number"==typeof a.strokeWeight&&(s.strokeWeight=a.strokeWeight),s.strokeAlign=a.strokeAlign,"strokeCap"in a&&"string"==typeof a.strokeCap&&(s.strokeCap=a.strokeCap),"strokeJoin"in a&&"string"==typeof a.strokeJoin&&(s.strokeJoin=a.strokeJoin),"strokeMiterLimit"in a&&"number"==typeof a.strokeMiterLimit&&(s.strokeMiterLimit=a.strokeMiterLimit),"strokeDashes"in a&&Array.isArray(a.strokeDashes)&&(s.strokeDashes=a.strokeDashes)),"cornerRadius"in a)if("number"==typeof a.cornerRadius)s.cornerRadius=a.cornerRadius;else if(a.cornerRadius&&"object"==typeof a.cornerRadius){const e=a.cornerRadius;s.cornerRadius={topLeft:e.topLeft,topRight:e.topRight,bottomRight:e.bottomRight,bottomLeft:e.bottomLeft}}if("effects"in a&&Array.isArray(a.effects)&&(s.effects=a.effects.map((e=>"DROP_SHADOW"===e.type||"INNER_SHADOW"===e.type?{type:e.type,color:e.color,offset:e.offset,radius:e.radius,spread:e.spread,visible:e.visible,blendMode:e.blendMode}:"LAYER_BLUR"===e.type||"BACKGROUND_BLUR"===e.type?{type:e.type,radius:e.radius,visible:e.visible}:e))),"TEXT"===a.type&&("number"==typeof a.fontSize&&(s.fontSize=a.fontSize),e(a.fontName)&&(s.fontName=a.fontName),s.textAlignHorizontal=a.textAlignHorizontal,s.textAlignVertical=a.textAlignVertical,"number"==typeof a.letterSpacing&&(s.letterSpacing=a.letterSpacing),"number"==typeof a.lineHeight&&(s.lineHeight=a.lineHeight),t(a.textCase)&&(s.textCase=a.textCase),n(a.textDecoration)&&(s.textDecoration=a.textDecoration),a.textAutoResize&&(s.textAutoResize=a.textAutoResize)),"constraints"in a){const{horizontal:e,vertical:t}=a.constraints;o(e)&&r(t)&&(s.constraints={horizontal:e,vertical:t})}return"opacity"in a&&"number"==typeof a.opacity&&(s.opacity=a.opacity),"visible"in a&&"boolean"==typeof a.visible&&(s.visible=a.visible),"locked"in a&&"boolean"==typeof a.locked&&(s.locked=a.locked),"preserveRatio"in a&&"boolean"==typeof a.preserveRatio&&(s.preserveRatio=a.preserveRatio),"blendMode"in a&&"string"==typeof a.blendMode&&(s.blendMode=a.blendMode),"exportSettings"in a&&(s.exportSettings=[...a.exportSettings]),s}function p(e){const t=e.name.toLowerCase();for(const[e,n]of Object.entries(a)){const i=n.components.some((e=>t.includes(e))),o=n.styles.some((e=>t.includes(e)));if(i||o)return e}return"React Native Paper"}function d(e){const t=new Set,n=e.name.toLowerCase();for(const[e,i]of Object.entries(s))i.patterns.some((e=>n.includes(e)))&&(i.permissions.android.forEach((e=>t.add(e))),i.permissions.ios.forEach((e=>t.add(e))));return Array.from(t)}function g(e){const t=new Set,n=e.name.toLowerCase();for(const[e,i]of Object.entries(c))i.patterns.some((e=>n.includes(e)))&&t.add(e);return Array.from(t)}const m={isAnalyzing:!1,isExporting:!1,lastError:null,selectedDesignSystem:"Custom"};function y(e,t){figma.ui.postMessage({type:e,payload:t})}function u(e,t){console.error(`Error in ${t}:`,e),m.lastError=e.message,figma.notify(`Error in ${t}: ${e.message}`,{error:!0})}figma.showUI(__html__,{width:400,height:600}),console.log("Sending initial state"),y("PLUGIN_READY"),y("PAGE_INFO",{name:figma.currentPage.name,nodeCount:figma.currentPage.children.length}),figma.ui.onmessage=a=>{return s=void 0,c=void 0,h=function*(){var s;console.log("Plugin received message:",a);try{switch(a.type){case"INIT":console.log("Received INIT message, sending PLUGIN_READY"),y("PLUGIN_READY"),y("PAGE_INFO",{name:figma.currentPage.name,nodeCount:figma.currentPage.children.length});break;case"ANALYZE_SCREENS":{if(m.isAnalyzing)throw new Error("Analysis already in progress");const c=figma.currentPage.selection.filter((e=>"FRAME"===e.type));if(console.log("Selected frames:",c.length),c.length<1)throw new Error("Please select at least 1 frame to analyze.");if(c.length>8)throw new Error("Please select no more than 8 frames to analyze.");(null===(s=a.payload)||void 0===s?void 0:s.designSystem)&&(m.selectedDesignSystem=a.payload.designSystem),m.isAnalyzing=!0,y("ANALYSIS_STARTED");try{const a=function(a){try{const s=[];for(const c of a){if("FRAME"!==c.type)continue;const a=[],m=new Set,y=new Set,u=new Set,f=new Map;c.findAll((s=>{var p,h;const A={id:s.id,name:s.name,type:s.type.toLowerCase(),position:{x:s.x,y:s.y},dimensions:{width:s.width,height:s.height},styling:l(s),parent:null===(p=s.parent)||void 0===p?void 0:p.id,children:"children"in s?s.children.map((e=>e.id)):[],zIndex:s.parent?s.parent.children.indexOf(s):0};if("TEXT"===s.type&&(A.content=s.characters,A.textStyle={fontSize:"number"==typeof s.fontSize?s.fontSize:16,fontName:e(s.fontName)?s.fontName:{family:"Inter",style:"Regular"},textAlignHorizontal:s.textAlignHorizontal,textAlignVertical:s.textAlignVertical,letterSpacing:"number"==typeof s.letterSpacing?s.letterSpacing:0,lineHeight:"number"==typeof s.lineHeight?s.lineHeight:1.2,textCase:t(s.textCase)&&"SMALL_CAPS"!==s.textCase?s.textCase:"ORIGINAL",textDecoration:n(s.textDecoration)?s.textDecoration:"NONE"}),"layoutMode"in s&&"NONE"!==s.layoutMode&&(A.autoLayout={direction:s.layoutMode,alignment:s.primaryAxisAlignItems,counterAlignment:s.counterAxisAlignItems,spacing:s.itemSpacing,padding:{top:s.paddingTop,right:s.paddingRight,bottom:s.paddingBottom,left:s.paddingLeft},layoutWrap:s.layoutWrap,layoutAlign:!i(s.layoutAlign)||"STRETCH"!==s.layoutAlign&&"INHERIT"!==s.layoutAlign?"STRETCH":s.layoutAlign,layoutGrow:s.layoutGrow}),"layoutGrids"in s&&Array.isArray(s.layoutGrids)&&(A.gridLayout=s.layoutGrids.map((e=>({pattern:e.pattern,sectionSize:e.sectionSize,visible:e.visible,color:e.color,alignment:e.alignment,gutterSize:e.gutterSize,count:e.count,offset:e.offset})))),"constraints"in s){const{horizontal:e,vertical:t}=s.constraints;o(e)&&r(t)&&(A.constraints={horizontal:e,vertical:t})}if("effects"in s&&Array.isArray(s.effects)&&s.effects.length>0&&(A.effects=s.effects.map((e=>({type:e.type,properties:e})))),s.name.toLowerCase().includes("hover")||s.name.toLowerCase().includes("active")||s.name.toLowerCase().includes("pressed")){const e=s.name.split("/")[0];f.has(e)||f.set(e,[]),null===(h=f.get(e))||void 0===h||h.push({state:s.name.toLowerCase().includes("hover")?"hover":s.name.toLowerCase().includes("active")?"active":"pressed",nodeId:s.id})}a.push(A);const E=d(s),S=g(s);return E.forEach((e=>y.add(e))),S.forEach((e=>m.add(e))),(s.name.toLowerCase().includes("nav")||s.name.toLowerCase().includes("menu"))&&(s.name.toLowerCase().includes("tab")||s.name.toLowerCase().includes("drawer"),"findAll"in s&&"function"==typeof s.findAll&&s.findAll((e=>("FRAME"===e.type&&e!==c&&u.add(e.name),!1)))),!1}));const h={id:`screen-${c.id}`,name:c.name,dimensions:{width:c.width,height:c.height},layout:l(c),designSystem:p(c),elements:a,dependencies:Array.from(m),permissions:Array.from(y),interactions:Object.fromEntries(f)};u.size>0&&(h.navigation={type:"stack",screens:Array.from(u)}),s.push(h)}return s}catch(e){return console.error("Error analyzing screens:",e),figma.notify("Error analyzing screens. Please try again.",{error:!0}),[]}}(c,m.selectedDesignSystem);y("ANALYSIS_COMPLETE",{screenSpecs:a,designSystem:m.selectedDesignSystem})}catch(e){u(e,"screen analysis"),y("ANALYSIS_FAILED")}finally{m.isAnalyzing=!1}break}case"EXPORT_BUNDLE":{if(m.isExporting)throw new Error("Export already in progress");const{screenSpecs:e}=a.payload;m.isExporting=!0,y("EXPORT_STARTED");try{const t=yield function(e,t){return n=this,i=void 0,r=function*(){try{const n=[],i=[];for(const o of e){n.push({screenName:o.name,designSystem:t,specifications:JSON.stringify(o,null,2),accessibilityRequirements:JSON.stringify({elements:o.elements.map((e=>({id:e.id,name:e.name,type:e.type,role:"text"===e.type?"text":"image"===e.type||"vector"===e.type?"image":"group"})))},null,2)});for(const e of o.elements)if("image"===e.type||"vector"===e.type){const t=figma.getNodeById(e.id);if(t&&"exportAsync"in t){const n=yield t.exportAsync({format:"PNG",constraint:{type:"SCALE",value:2}});i.push({name:`${e.name}.png`,data:n})}}}return{screenSpecs:e,aiPrompts:n,assets:i}}catch(e){throw console.error("Error generating export bundle:",e),figma.notify("Error generating export bundle. Please try again.",{error:!0}),e}},new((o=void 0)||(o=Promise))((function(e,t){function a(e){try{c(r.next(e))}catch(e){t(e)}}function s(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(a,s)}c((r=r.apply(n,i||[])).next())}));var n,i,o,r}(e,m.selectedDesignSystem);y("EXPORT_COMPLETE",{bundle:t})}catch(e){u(e,"export"),y("EXPORT_FAILED")}finally{m.isExporting=!1}break}default:console.log("Unknown message type:",a.type)}}catch(e){console.error("Error handling message:",e),u(e,"message handling")}},new((f=void 0)||(f=Promise))((function(e,t){function n(e){try{o(h.next(e))}catch(e){t(e)}}function i(e){try{o(h.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof f?o:new f((function(e){e(o)}))).then(n,i)}o((h=h.apply(s,c||[])).next())}));var s,c,f,h},figma.on("close",(()=>{m.isAnalyzing=!1,m.isExporting=!1,m.lastError=null}))})();